<div class="item-details-page">
  <div class="details-inner">
    <a routerLink="/items/mine" class="back-link">
      ← Volver al listado
    </a>

    <ng-container *ngIf="busy(); else contentTpl">
      <div class="loading">Cargando detalles…</div>
    </ng-container>

    <ng-template #contentTpl>
      <ng-container *ngIf="!error(); else errorTpl">
        <ng-container *ngIf="item() as it">

          <!-- CARD PRINCIPAL -->
          <section class="details-card">

            <!-- Encabezado -->
            <header class="details-header">
              <div class="title-block">
                <span class="eyebrow">Ficha filatélica</span>
                <h1>{{ it.title || 'Sin título' }}</h1>
                <p class="subtitle" *ngIf="it.country || it.issueYear">
                  <span *ngIf="it.country">{{ it.country | titlecase }}</span>
                  <span *ngIf="it.country && it.issueYear"> • </span>
                  <span *ngIf="it.issueYear">{{ it.issueYear }}</span>
                </p>
              </div>

              <div class="header-meta" *ngIf="it.createdAt || it.updatedAt">
                <div *ngIf="it.createdAt">
                  <span class="meta-label">Creado</span>
                  <span class="meta-value">
                    {{ it.createdAt | date:'dd/MM/yyyy HH:mm':'UTC' }}
                  </span>
                </div>
                <div *ngIf="it.updatedAt">
                  <span class="meta-label">Actualizado</span>
                  <span class="meta-value">
                    {{ it.updatedAt | date:'dd/MM/yyyy HH:mm':'UTC' }}
                  </span>
                </div>
              </div>
            </header>

            <!-- Layout 2 columnas -->
            <div class="details-layout">
              <!-- Columna izquierda: imagen -->
              <aside class="left-column">
                <div class="image-card">
                  <div class="image-inner">
                    <img
                      *ngIf="it.cover; else noCover"
                      [src]="it.cover!"
                      [alt]="it.title || 'Pieza filatélica'"
                    />
                    <ng-template #noCover>
                      <div class="no-cover">Sin imagen</div>
                    </ng-template>
                  </div>

                  <div class="image-caption">
                    <span class="badge">
                      {{ it.country ? (it.country | titlecase) : 'País no definido' }}
                    </span>
                    <span class="badge" *ngIf="it.issueYear">
                      Año {{ it.issueYear }}
                    </span>
                    <span class="badge soft" *ngIf="it.visibility">
                      {{ it.visibility === 'public' ? 'Público' : 'Privado' }}
                    </span>
                  </div>
                </div>
              </aside>

              <!-- Columna derecha: información -->
              <section class="right-column">

                <!-- Card de metadatos -->
                <section class="section-card">
                  <h2 class="section-title">Datos principales</h2>
                  <dl class="meta-grid">
                    <div>
                      <dt>País</dt>
                      <dd>{{ it.country ? (it.country | titlecase) : '—' }}</dd>
                    </div>

                    <div>
                      <dt>Año de emisión</dt>
                      <dd>{{ it.issueYear || '—' }}</dd>
                    </div>

                    <div>
                      <dt>Condición</dt>
                      <dd>{{ it.conditionCode || '—' }}</dd>
                    </div>

                    <div>
                      <dt>Código de catálogo</dt>
                      <dd>{{ it.catalogCode || '—' }}</dd>
                    </div>

                    <div>
                      <dt>Valor facial</dt>
                      <dd>
                        <ng-container
                          *ngIf="it.faceValue !== null && it.faceValue !== undefined; else dash"
                        >
                          {{ it.faceValue }}
                          <span *ngIf="it.currency">({{ it.currency }})</span>
                        </ng-container>
                        <ng-template #dash>—</ng-template>
                      </dd>
                    </div>

                    <div>
                      <dt>Fecha de adquisición</dt>
                      <dd>
                        {{
                          it.acquisitionDate
                            ? (it.acquisitionDate | date:'dd/MM/yyyy':'UTC')
                            : '—'
                        }}
                      </dd>
                    </div>
                  </dl>
                </section>

                <!-- Card descripción -->
                <section class="section-card" *ngIf="it.description">
                  <h2 class="section-title">Descripción</h2>
                  <p class="description-text">
                    {{ it.description }}
                  </p>
                </section>

                <!-- Card tags -->
                <section class="section-card" *ngIf="it.tags?.length">
                  <h2 class="section-title">Tags</h2>
                  <div class="tags-list">
                    <span class="tag-pill" *ngFor="let t of it.tags">
                      #{{ t.name }}
                    </span>
                  </div>
                </section>

                <!-- Card atributos -->
                <section class="section-card" *ngIf="it.attributes?.length">
                  <h2 class="section-title">Atributos adicionales</h2>
                  <div class="attrs-grid">
                    <article class="attr-box" *ngFor="let a of it.attributes">
                      <div class="attr-header">
                        <span class="attr-chip">{{ a.attrType || 'Texto' }}</span>
                        <span class="attr-name">{{ a.name }}</span>
                      </div>
                      <p class="attr-value">
                        {{ a.value ?? '—' }}
                      </p>
                    </article>
                  </div>
                </section>

              </section>
            </div>
          </section>

        </ng-container>
      </ng-container>

      <ng-template #errorTpl>
        <div class="error-box">{{ error() }}</div>
      </ng-template>
    </ng-template>
  </div>
</div>
